<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolify Pro | Studio Gradient</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #ffffff; --surface: #f9fafb; --border: #e5e7eb; --text-main: #111827; --text-muted: #6b7280; --accent: #2563eb; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); display: flex; justify-content: center; padding: 40px 16px; }
        .studio-card { width: 100%; max-width: 1100px; display: grid; grid-template-columns: 1fr 320px; gap: 32px; }
        @media (max-width: 900px) { .studio-card { grid-template-columns: 1fr; } }
        .gradient-canvas { width: 100%; height: 170px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 40px; position: relative; cursor: crosshair; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .handle { position: absolute; top: 100%; width: 22px; height: 22px; background: #fff; border: 2.5px solid var(--text-main); border-radius: 50%; transform: translate(-50%, 8px); cursor: grab; z-index: 10; touch-action: none; }
        .handle.active { background: var(--accent); border-color: var(--accent); transform: translate(-50%, 8px) scale(1.15); }
        .controls { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; display: flex; flex-direction: column; gap: 20px; }
        label { display: block; font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.05em; }
        input, select, .btn { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); font-size: 14px; background: white; outline: none; }
        .btn { cursor: pointer; font-weight: 600; text-align: center; background: #fff; }
        .btn:hover { background: #f3f4f6; }
        .undo-row { display: flex; gap: 10px; }
        .stop-row { display: flex; align-items: center; gap: 12px; padding: 10px; background: white; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; margin-bottom: 8px; }
        .stop-row.active { border-color: var(--accent); background: #eff6ff; }
        .del-btn { margin-left: auto; border: none; background: none; color: #ef4444; font-size: 18px; cursor: pointer; }
        .css-output { grid-column: span 2; background: #0f172a; color: #38bdf8; padding: 24px; border-radius: 12px; font-family: monospace; position: relative; word-break: break-all; margin-top: 20px;}
        .copy-btn { position: absolute; right: 16px; top: 16px; background: #1e293b; color: white; border: 1px solid #334155; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
        #hueRange { -webkit-appearance: none; height: 12px; border-radius: 6px; background: linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00); }
        #hueRange::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; background: white; border: 2.5px solid #000; cursor: pointer; }
        input:disabled { opacity: 0.4; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="studio-card">
    <div>
        <h1>Studio Gradient</h1>
        <p style="color:var(--text-muted); margin-bottom:24px">Universal Gradient Engine v3.1</p>
        <div class="gradient-canvas" id="canvas"><div id="visualPreview" style="width:100%; height:100%; border-radius:11px"></div></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div><label>Hex</label><input type="text" id="hexDisplay" maxlength="7"></div>
            <div><label>Hue</label><input type="range" id="hueRange" min="0" max="360" value="0"></div>
        </div>
    </div>
    <div class="controls">
        <div><label>Type</label><select id="gType"><option value="linear">Linear</option><option value="radial">Radial</option></select></div>
        <div><label id="angLabel">Angle</label><input type="number" id="gAngle" value="90" min="0" max="360"></div>
        <div class="undo-row"><button class="btn" onclick="undo()">Undo</button><button class="btn" onclick="redo()">Redo</button></div>
        <div><label>Presets</label><select id="presetSelect">
            <option value="">Custom</option>
            <option value="sunset">Classic Sunset</option>
            <option value="ocean">Deep Ocean</option>
            <option value="neon">Neon Night</option>
            <option value="center">Radial Glow</option>
        </select></div>
        <div><label>Stops</label><div id="stopInfo"></div></div>
    </div>
    <div class="css-output"><button class="copy-btn" onclick="copyCSS()">Copy CSS</button><code id="cssCode"></code></div>
</div>

<script>
    let stops = [{c:"#3b82f6",p:0}, {c:"#10b981",p:100}];
    let activeIdx = 0;
    let history = [];
    let future = [];
    let rafId = null;

    const canvas = document.getElementById('canvas'), visualPreview = document.getElementById('visualPreview');
    const cssCode = document.getElementById('cssCode'), stopInfo = document.getElementById('stopInfo');
    const hexDisplay = document.getElementById('hexDisplay'), gType = document.getElementById('gType');
    const gAngle = document.getElementById('gAngle'), hueRange = document.getElementById('hueRange'), presetSelect = document.getElementById('presetSelect');

    function hexToHue(hex) {
        let r = parseInt(hex.slice(1,3), 16) / 255, g = parseInt(hex.slice(3,5), 16) / 255, b = parseInt(hex.slice(5,7), 16) / 255;
        let max = Math.max(r, g, b), min = Math.min(r, g, b), h, d = max - min;
        if (d === 0) h = 0;
        else {
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return Math.round(h * 360);
    }

    function hslToHex(h, s, l) {
        l /= 100; const a = s * Math.min(l, 1 - l) / 100;
        const f = n => {
            const k = (n + h / 30) % 12;
            const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
            return Math.round(255 * color).toString(16).padStart(2, '0');
        };
        return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
    }

    function pushHistory() {
        const state = JSON.stringify({stops, type: gType.value, angle: gAngle.value});
        if (history.length === 0 || history[history.length - 1] !== state) {
            history.push(state);
            if (history.length > 50) history.shift();
            future = [];
        }
    }

    function render(skipHistory = false) {
        if (rafId) cancelAnimationFrame(rafId);
        rafId = requestAnimationFrame(() => {
            const sorted = [...stops].sort((a, b) => a.p - b.p);
            const type = gType.value, angle = gAngle.value;
            const sStr = sorted.map(x => `${x.c} ${x.p}%`).join(", ");
            const css = type === "linear" ? `linear-gradient(${angle}deg, ${sStr})` : `radial-gradient(circle, ${sStr})`;
            
            visualPreview.style.background = css;
            cssCode.textContent = `background: ${css};`;
            
            if (stops[activeIdx]) {
                hexDisplay.value = stops[activeIdx].c;
                hueRange.value = hexToHue(stops[activeIdx].c);
            }

            gAngle.disabled = (type === "radial");
            document.getElementById('angLabel').style.opacity = (type === "radial" ? "0.4" : "1");

            renderUI();
            if (!skipHistory) pushHistory();
        });
    }

    function renderUI() {
        document.querySelectorAll(".handle").forEach(h => h.remove());
        stopInfo.innerHTML = "";
        stops.forEach((s, i) => {
            const h = document.createElement("div");
            h.className = "handle" + (i === activeIdx ? " active" : "");
            h.style.left = s.p + "%";
            
            const startMove = e => { 
                e.preventDefault(); activeIdx = i; render(true); moveHandler(e, i); 
            };
            h.addEventListener('mousedown', startMove);
            h.addEventListener('touchstart', startMove, {passive: false});
            canvas.appendChild(h);

            const d = document.createElement("div");
            d.className = "stop-row" + (i === activeIdx ? " active" : "");
            d.innerHTML = `<div style="width:14px;height:14px;border-radius:3px;background:${s.c};border:1px solid #ddd"></div>
                <span style="font-family:monospace;font-weight:600;flex:1">${s.c}</span><span>${s.p}%</span>
                <button class="del-btn" onclick="removeStop(event, ${i})">Ã—</button>`;
            d.onclick = () => { activeIdx = i; render(true); };
            stopInfo.appendChild(d);
        });
    }

    function moveHandler(e, i) {
        const getX = m => m.touches ? m.touches[0].clientX : m.clientX;
        const move = m => {
            const r = canvas.getBoundingClientRect();
            stops[i].p = Math.max(0, Math.min(100, Math.round(((getX(m) - r.left) / r.width) * 100)));
            render(true);
        };
        const up = () => { 
            window.removeEventListener('mousemove', move); window.removeEventListener('touchmove', move); pushHistory(); 
        };
        window.addEventListener('mousemove', move);
        window.addEventListener('touchmove', move, {passive: false});
        window.addEventListener('mouseup', up, {once:true});
        window.addEventListener('touchend', up, {once:true});
    }

    canvas.onclick = e => {
        if (e.target.classList.contains("handle")) return;
        const r = canvas.getBoundingClientRect();
        stops.push({c: "#ffffff", p: Math.round(((e.clientX - r.left) / r.width) * 100)});
        activeIdx = stops.length - 1;
        render();
    };

    hexDisplay.oninput = function() { if (/^#[0-9A-F]{6}$/i.test(this.value)) { stops[activeIdx].c = this.value.toUpperCase(); render(); } };
    hueRange.oninput = function() { stops[activeIdx].c = hslToHex(this.value, 70, 50); render(true); };
    hueRange.onchange = () => pushHistory();
    gType.onchange = () => render();
    gAngle.oninput = function() { this.value = Math.max(0, Math.min(360, this.value)); render(); };

    presetSelect.onchange = function() {
        const presets = {
            sunset: { type: "linear", angle: 90, stops: [{c: "#ff7e5f", p:0}, {c: "#feb47b", p:100}] },
            ocean: { type: "linear", angle: 180, stops: [{c: "#2193b0", p:0}, {c: "#6dd5ed", p:100}] },
            neon: { type: "linear", angle: 45, stops: [{c: "#00f260", p:0}, {c: "#0575e6", p:100}] },
            center: { type: "radial", angle: 0, stops: [{c: "#ffffff", p:0}, {c: "#000000", p:100}] }
        };
        const p = presets[this.value];
        if (p) {
            stops = p.stops; gType.value = p.type; gAngle.value = p.angle; activeIdx = 0; render();
        }
    };

    function removeStop(e, i) {
        e.stopPropagation();
        if (stops.length > 2) {
            stops.splice(i, 1);
            activeIdx = (i === activeIdx) ? Math.max(0, i - 1) : (i < activeIdx ? activeIdx - 1 : activeIdx);
            render();
        }
    }

    function undo() {
        if (history.length > 1) { future.push(history.pop()); const s = JSON.parse(history[history.length-1]); stops = s.stops; gType.value = s.type; gAngle.value = s.angle; activeIdx = 0; render(true); }
    }
    function redo() {
        if (future.length) { const s = JSON.parse(future.pop()); history.push(JSON.stringify(s)); stops = s.stops; gType.value = s.type; gAngle.value = s.angle; activeIdx = 0; render(true); }
    }

    window.onkeydown = e => {
        if (e.ctrlKey || e.metaKey) {
            if (e.key === 'z') { e.preventDefault(); undo(); }
            if (e.key === 'y') { e.preventDefault(); redo(); }
        }
        if (!['INPUT','SELECT'].includes(document.activeElement.tagName)) {
            if (e.key === 'ArrowLeft') { stops[activeIdx].p = Math.max(0, stops[activeIdx].p - 1); render(); }
            if (e.key === 'ArrowRight') { stops[activeIdx].p = Math.min(100, stops[activeIdx].p + 1); render(); }
            if (e.key === 'Delete' || e.key === 'Backspace') removeStop(e, activeIdx);
        }
    };

    function copyCSS() { 
        const btn = document.querySelector('.copy-btn');
        navigator.clipboard.writeText(cssCode.textContent);
        btn.textContent = "Copied!";
        setTimeout(() => btn.textContent = "Copy CSS", 1500);
    }
    
    pushHistory();
    render(true);
</script>
</body>
</html>